<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Practice</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4"
    crossorigin="anonymous">

  <!-- Main styles for this application-->
  <link rel="stylesheet/less" type="text/css" href="css/style.less" />
  <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/3.0.2/less.min.js"></script>
</head>
<script type='text/javascript'>
  //<![CDATA[

  // Set cookie
  function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
    var expires = "expires=" + d.toUTCString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
  }

  // Read cookie
  function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return "";
  }

  //delete cookie
  function deleteCookie(name, path, domain) {
    if (getCookie(name)) {
      document.cookie = name + "=" +
        ((path == null) ? "" : "; path=" + path) +
        ((domain == null) ? "" : "; domain=" + domain) +
        "; expires=Thu, 01-Jan-70 00:00:01 GMT";
    }
  }

  //]]>
</script>

<body>
  <div class="header">
    <div class="row title">
      <div class="col">
        <img src="img/logo.png" class="logo img-fluid" width="100" height="64">
      </div>
      <div class="col">
        <h6 class="title-text" id="message">
          <button id="modalLogin" class="btn btn-primary ml-auto">Login</button>
        </h6>
      </div>
    </div>
  </div>
  <div class="main ">
    <div class="wrapper-login">
      <div class="row">
        <div class="col">
          <h2 class="txtWelcome pt-5 text-center">Welcome!</h2>
        </div>
      </div>

    </div>
    <div class="wrapper-profile">
      <img id="modalEdit" class="rounded img-fluid img-thumbnail" alt="User1">
      <img id="modalEdit2" class="rounded img-fluid img-thumbnail" alt="User2">
    </div>
  </div>
  <div class="footer">
    <div class="">
      <span>@copyright 2018</span>
    </div>
  </div>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
    crossorigin="anonymous"></script>
  <script src="Cookies.js"></script>
  <script>
    $(function () {
      //Get avatar
      $.ajax({
        'async': false,
        'global': false,
        'url': "json/users.json",
        'dataType': "json",
        'success': function (data) {
          json = data;
          $.each(json, function (i, item) {
            $("#modalEdit").attr("src", json[0].profile.avatar).css("cursor", "pointer");
            $("#modalEdit2").attr("src", json[1].profile.avatar).css("cursor", "pointer");
          });
        }
      });
      //End getavatar

      //Xu ly popup login
      $("#modalLogin").on('click', function () {
        $("#txtEmail").val();
        $("#txtPwd").val();
        $("#txtID").val();
        $("#txtID2").val();
        $("#loginModal").modal('show');
      });

      //Handle click Login
      $("#btnLogin").on('click', function () {
        var email = $("#txtEmail").val();
        var pass = $("#txtPwd").val();
        var currentUser = "";
        var hello = $("#message");
        var thongbao = $("#thongbao");
        thongbao.html();
        let json = null;
        $.ajax({
          'async': false,
          'global': false,
          'url': "json/users.json",
          'dataType': "json",
          'success': function (data) {
            json = data;
            $.each(json, function (i, item) {
              if (email == item.email && pass == item.password) { //Check login success
                setCookie("email", email);
                setCookie("pass", pass);
                setCookie("currentUser", item.id);

                var emailCookie = getCookie("email"); //txtEail
                var passCookie = getCookie("pass"); //txtPassword
                var idCookie = getCookie("currentUser"); //id user login

                thongbao.html("");
                $("#loginModal").modal("hide");
                hello.html("<span>Hello, " + item.profile.firstName + "</span>" +
                  ` <button id="btnLogOut" class="btn btn-warning btn-sm">Log out</button>`);

                var idUser = $("#txtID").val("jaksdk934hfd634"); //Set ID for user1
                setCookie("user1", idUser.val());
                var idUser2 = $("#txtID2").val("8hjvhdf4wdedfg80"); //Set ID for user
                setCookie("user2", idUser2.val());

                var idUserValue = getCookie("user1"); //Get ID for user1
                var idUserValue2 = getCookie("user2"); //Get ID for user2
                //Check ID user after login and ID of User
                if (idCookie == idUserValue) {
                  $("#modalEdit").on('click', function () {
                    $("#txtID").val(item.id);
                    $("#txtFN").val(item.profile.firstName);
                    $("#txtLN").val(item.profile.lastName);
                    $("#txtPwdEdit").val(item.password);
                    $("#txtEmailEdit").val(item.email);
                    $("#editModal").modal('show');
                    $("editMOdal").modal('show');
                  });
                  $("#modalEdit2").on('click',function(){
                    $("#editModal2").modal('hide');        
                  });

                } else if (idCookie == idUserValue2) {
                  $("#modalEdit").on('click', function () {
                    $("#txtFN").val("ABC");
                    $("#txtLN").val("DEF");
                    $("#txtPwdEdit").val("");
                    $("#txtEmailEdit").val("");                 
                  });
                  $("#modalEdit2").on('click', function () {
                    $("#txtID2").val(item.id);
                    $("#txtFN2").val(item.profile.firstName);
                    $("#txtLN2").val(item.profile.lastName);
                    $("#txtPwdEdit2").val(item.password);
                    $("#txtEmailEdit2").val(item.email);
                    $("#editModal2").modal('show');
                  });
                } else {
                  $("#modalEdit").on('click', function () {
                    $("#editModal").modal('hide');
                  });
                  // $("#modalEdit2").on('click',function(){
                  //   $("#editModal2").modal('hide');    
                  // });
                }
                return
              } else {
                thongbao.html("Wrong username or password");
              }

            });

          }
        });
        //Handle click Logout
        $("#btnLogOut").on('click', function () {
          var crm = confirm("Bạn có chắc đăng xuất");
          if (crm) {
              $("#modalEdit").on('click', function () {
              $("#txtID").val("");
              $("#txtFN").val("");
              $("#txtLN").val("");
              $("#txtPwdEdit").val("");
              $("#txtEmailEdit").val("");
              $("#txtCPwd").val("");
            });
            $("#modalEdit2").on('click', function () {
              $("#txtID2").val("");
              $("#txtFN2").val("");
              $("#txtLN2").val("");
              $("#txtPwdEdit2").val("");
              $("#txtEmailEdit2").val("");
              $("#txtCPwd2").val("");
            });
            // setCookie("email",email);
            // setCookie("pass",pass);
            // setCookie("currentUser",item.id);//Get User after login
            // setCookie("user1",idUser.val());
            // setCookie("user2",idUser2.val());
            console.log("Info after logout: --------");
            console.log("Id cookie out: " + getCookie("currentUser"));
            console.log("Email cookie out: " + getCookie("email"));
            console.log("pass cookie out: " + getCookie("pass"));
            deleteCookie("currentUser");
            deleteCookie("email");
            deleteCookie("pass");
            console.log("Info after delete cookie: --------");
            console.log("Id cookie after delete: " + getCookie("currentUser"));
            console.log("Email cookie after delete: " + getCookie("email"));
            console.log("pass cookie after delete: " + getCookie("pass"));
            // setCookie("currentUser",null)
            // setCookie("email",null)
            // setCookie("pass",null)
            // console.log("Id cookie after set: " + getCookie("currentUser"));
            // console.log("Email cookie after set: " + getCookie("email"));
            // console.log("pass cookie after delete: " + getCookie("pass"));
            // deleteCookie("user1");
            // deleteCookie("user2");
            hello.html(`<button id="modalLogin" class="btn btn-primary">Login</button>`);
            $("#modalLogin").click(function () {
              thongbao.html("");
              $("txtEmail").html("");
              $("#txtPwd").html("");
              $("#loginModal").modal("show");
              let json = null;
              $.ajax({
                'async': false,
                'global': false,
                'url': "json/users.json",
                'dataType': "json",
                'success': function (data) {
                  json = data;
                  $.each(json, function (i, item) {
                    setCookie("email", email);
                    setCookie("pass", pass);
                    setCookie("currentUser", item.id);
                    var getMail = getCookie("email");
                    var getPwd = getCookie("pass");
                    var getIdLogin = getCookie("currentUser");
                    // console.log("Email la: " + getMail);
                    // console.log("pass la: " + getPwd);
                    // console.log("currentUser la: " + getIdLogin);
                    // console.log("Info after out and click modal Login: --------");
                    // console.log("Ajax email: " + email);
                    // console.log("Ajax pass: " + pass);
                    // console.log("Ajax id: " + item.id);
                    // console.log("Ajax user1:" + getCookie("user1"));
                    // console.log("Ajax user2:" + getCookie("user2"));
                    //Check login again after log out
                    if (getMail == item.mail && getPwd == item.password) {
                      thongbao.html("");
                      $("#loginModal").modal("hide");
                      hello.html("<span>Hello, " + item.profile.firstName + "</span>" +
                        ` <button id="btnLogOut" class="btn btn-warning btn-sm">Log out</button>`
                      );
                      if (getIdLogin == idUserValue) {
                        $("#modalEdit").on('click', function () {
                          $("#txtFN").val(item.profile.firstName);
                          $("#txtLN").val(item.profile.lastName);
                          $("#txtPwdEdit").val(item.password);
                          $("#txtEmailEdit").val(item.email);
                          $("#editModal").modal('show');
                        });
                        $("#modalEdit2").on('click', function () {
                          $("#editModal2").modal('hide');
                        });
                      }
                    }
                  });
                }
              });
            });
          
          } else {
            return false;
          }
        });
      });
      //End handle click Login
      //Handle edit profile
      $("#btnSave").on('click', function () {
        var pass = $("#txtPwd").val();
        var txtFN = $("#txtFN").val();
        var txtLN = $("#txtLN").val();
        var txtPwd = $("#txtPwdEdit").val();
        var txtCPwd = $("#txtCPwd").val();
        var txtID = $("#txtID").val();
        var email = $("#txtEmail").val();
        var txtEmail = $("#txtEmailEdit").val();
        var thongbaoEdit = $("#thongbaoEdit");
        thongbaoEdit.html();
        //Validate data form
        var re = /[0-9]/;
        if (txtFN.length < 4 || re.test(txtFN) || txtLN.length < 4 || re.test(txtLN)) {
          thongbaoEdit.html("Invalid data");
        } else if (txtPwd != txtCPwd) {
          thongbaoEdit.html("Mật khẩu không trùng khớp");
        } else {
          thongbaoEdit.html("");
        }
      });
      //End handle edit profile
    });
  </script>

  <!-- Modal Login-->
  <div class="modal fade" id="loginModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-secondary ">
          <h5>Login</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="frmLogin">
            <p id="thongbao" class="text-center text-danger"></p>
            <div class="form-group">
              <input type="email" class="form-control" name="txtEmail" id="txtEmail" placeholder="Email.....">
            </div>
            <div class="form-group">
              <input type="password" class="form-control" name="txtPwd" id="txtPwd" placeholder="Password.....">
            </div>
        </div>
        </form>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn btn-primary" id="btnLogin">Login</button>
        </div>
      </div>
    </div>
  </div>
  <!-- End div modal Login-->
  <!-- Modal Edit 1-->
  <div class="modal fade" id="editModal" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-secondary ">
          <h5>Edit Profile</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form method="POST" id="my-profile">
            <p id="thongbaoEdit" class="text-center text-danger"></p>
            <div class="form-group">
              <input type="text" class="form-control" name="txtID" id="txtID" readonly>
            </div>
            <div class="form-group">
              <input type="text" class="form-control" name="txtEmailEdit" id="txtEmailEdit" readonly>
            </div>
            <div class="form-group">
              <input type="text" class="form-control" name="txtFN" id="txtFN" placeholder="First Name.....">
            </div>
            <div class="form-group">
              <input type="text" class="form-control" name="txtLN" id="txtLN" placeholder="Last Name......">
            </div>
            <div class="form-group">
              <input type="password" class="form-control" name="txtPwdEdit" id="txtPwdEdit" placeholder="Password.....">
            </div>
            <div class="form-group">
              <input type="password" class="form-control" name="txtCPwd" id="txtCPwd" placeholder="Confirm Password.....">
            </div>
        </div>
        </form>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn btn-primary" id="btnSave">Save</button>
        </div>
      </div>
    </div>
  </div>
  <!-- End div modal edit 1-->

  <!-- Modal Edit 2-->
  <div class="modal fade" id="editModal2">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-secondary ">
          <h5>Edit Profile</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form method="POST">
            <p id="thongbaoEdit2" class="text-center text-danger"></p>
            <div class="form-group">
              <input type="text" class="form-control" name="txtID2" id="txtID2" readonly>
            </div>
            <div class="form-group">
              <input type="text" class="form-control" name="txtEmailEdit2" id="txtEmailEdit2" readonly>
            </div>
            <div class="form-group">
              <input type="text" class="form-control" name="txtFN2" id="txtFN2" placeholder="First Name.....">
            </div>
            <div class="form-group">
              <input type="text" class="form-control" name="txtLN2" id="txtLN2" placeholder="Last Name......">
            </div>
            <div class="form-group">
              <input type="password" class="form-control" name="txtPwdEdit2" id="txtPwdEdit2" placeholder="Password.....">
            </div>
            <div class="form-group">
              <input type="password" class="form-control" name="txtCPwd2" id="txtCPwd2" placeholder="Confirm Password.....">
            </div>
        </div>
        </form>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn btn-primary" id="btnSave2">Save</button>
        </div>
      </div>
    </div>
  </div>
  <!-- End div modal Edit 2-->
</body>

</html>
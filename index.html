<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Practice</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4"
    crossorigin="anonymous">

  <!-- Main styles for this application-->
  <link rel="stylesheet/less" type="text/css" href="css/style.less" />
  <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/3.0.2/less.min.js"></script>
</head>
<script type='text/javascript'>
  //<![CDATA[

  // Set cookie
  function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
    var expires = "expires=" + d.toUTCString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
  }

  // Read cookie
  function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return "";
  }

  //delete cookie
  function deleteCookie(name, path, domain) {
    if (getCookie(name)) {
      document.cookie = name + "=" +
        ((path == null) ? "" : "; path=" + path) +
        ((domain == null) ? "" : "; domain=" + domain) +
        "; expires=Thu, 01-Jan-70 00:00:01 GMT";
    }
  }

  //]]>
</script>

<body>
  <div class="header">
    <div class="row title">
      <div class="col">
        <img src="img/logo.png" class="logo img-fluid" width="100" height="64">
      </div>
      <div class="col">
        <h6 class="title-text" id="message">
          <button id="modalLogin" class="btn btn-primary ml-auto">Login</button>
        </h6>
      </div>
    </div>
  </div>
  <div class="main ">
    <div class="wrapper-login">
      <div class="row">
        <div class="col">
          <h2 class="txtWelcome pt-5 text-center" id="welcome">Welcome!</h2>
        </div>
      </div>

    </div>
    <div class="wrapper-profile">
      <div id="image"></div>
    </div>
  </div>
  <div class="footer">
    <div class="">
      <span>@copyright 2018</span>
    </div>
  </div>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
    crossorigin="anonymous"></script>
  <script src="Cookies.js"></script>
  <script>
    $(function () {
      idCurrentUser=null;
      function showPopupLogin(){
        $("#modalLogin").on('click', function () {
          $("#txtEmail").val();
          $("#txtPwd").val();
          $("#txtID").val();
          $("#txtID2").val();
          $("#loginModal").modal('show');
        });
      }
      showPopupLogin();
      //Show slider
      let idImage=null;
      $.getJSON( "json/users.json", function( data ) {
       let json=data;
       for(let i = 0 ; i < json.length;++i){
          idImage = $(
          '<img id="'+json[i].id+'" class="img-responsive img-profile" src="' + json[i].profile.avatar + '" />'
          // +('<img id="img2" class="img-responsive img-profile" src="' + json[1].profile.avatar + '" />')
          ).appendTo( "#image" );
          console.log("img "+ i + " : : " + idImage[0].id);
        }
      });
      
      //End show slider
     
      //Handle click Login
      $("#btnLogin").on('click', function (){
        var email = $("#txtEmail").val();
        var pass = $("#txtPwd").val();
        var currentUser = "";
        var hello = $("#message");
        var notice = $("#notice");
        let json = null;
        $.ajax({
          'async': false,
          'global': false,
          'url': "json/users.json",
          'dataType': "json",
          'success': function (data) {
            json = data;
            for(let i =0; i < json.length;++i) {
              if (email == json[i].email && pass == json[i].password){
                 idCurrentUser=json[i].id;
                console.log("Id when login : " + idCurrentUser);
                notice.html("");
                $("#loginModal").modal("hide");
                hello.html("<span>Hello, " + json[i].profile.firstName + "</span>" + " <button id='btnLogOut' class='btn btn-warning btn-sm'>Log out</button>");
                //Check ID user after login and ID of User
                // if (idCurrentUser == idUserValue){
                  $("img").on('click', function () {
                    var IdEdit=$(this).attr("id");
                    if(idCurrentUser==IdEdit){
                      $("#noticeEdit").html("");
                      $("#txtID").val(json[i].id);
                      $("#txtFN").val(json[i].profile.firstName);
                      $("#txtLN").val(json[i].profile.lastName);
                      $("#txtPwdEdit").val(json[i].password);
                      $("#txtEmailEdit").val(json[i].email);
                      $("#editModal").modal('show');
                    }
                    else{
                      return false;
                    }
                    });
                return
              }
          };
          notice.html("Wrong username or password");
          }
        });
      //Handle click Logout
        $("#btnLogOut").on('click', function () {
          var crm = confirm("Bạn có chắc đăng xuất");
          if (crm) {
            idCurrentUser=null;
            console.log("Id user after logout : " + idCurrentUser);
            hello.html(`<button id="modalLogin" class="btn btn-primary">Login</button>`);
            showPopupLogin();
          } else {
            return false;
          }
        });
      });
      //End handle click Login

      //Handle edit profile
      $("#btnSave").on('click', function () {
        var txtFN = $("#txtFN").val();
        var txtLN = $("#txtLN").val();
        var txtPwd = $("#txtPwdEdit").val();
        var txtCPwd = $("#txtCPwd").val();
        var txtEmail = $("#txtEmailEdit").val();
        var noticeEdit = $("#noticeEdit");
        //Validate data form
        var re = /[0-9]/;
        if (txtFN.length < 4 || re.test(txtFN) || txtLN.length < 4 || re.test(txtLN)) {
          noticeEdit.html("Invalid data");
        } else if (txtPwd != txtCPwd) {
          noticeEdit.html("Password not match matches");
        } else {
          noticeEdit.html("");
        }
      $.getJSON( "json/users.json", function( data ) {
       let json=data;
       for(let i = 0 ; i < json.length;++i){
         
        }
      });
        //End validate data form
      });
      //End handle edit profile
    });
  </script>

  <!-- Modal Login-->
  <div class="modal fade" id="loginModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-secondary ">
          <h5>Login</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="frmLogin">
            <p id="notice" class="text-center text-danger"></p>
            <div class="form-group">
              <input type="email" class="form-control" name="txtEmail" id="txtEmail" placeholder="Email.....">
            </div>
            <div class="form-group">
              <input type="password" class="form-control" name="txtPwd" id="txtPwd" placeholder="Password.....">
            </div>
        </div>
        </form>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn btn-primary" id="btnLogin">Login</button>
        </div>
      </div>
    </div>
  </div>
  <!-- End div modal Login-->
  <!-- Modal Edit-->
  <div class="modal fade" id="editModal" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-secondary ">
          <h5>Edit Profile</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form method="POST" id="my-profile">
            <p id="noticeEdit" class="text-center text-danger"></p>
            <div class="form-group">
              <input type="text" class="form-control" name="txtEmailEdit" id="txtEmailEdit" readonly>
            </div>
            <div class="form-group">
              <input type="text" class="form-control" name="txtFN" id="txtFN" placeholder="First Name.....">
            </div>
            <div class="form-group">
              <input type="text" class="form-control" name="txtLN" id="txtLN" placeholder="Last Name......">
            </div>
            <div class="form-group">
              <input type="password" class="form-control" name="txtPwdEdit" id="txtPwdEdit" placeholder="Password.....">
            </div>
            <div class="form-group">
              <input type="password" class="form-control" name="txtCPwd" id="txtCPwd" placeholder="Confirm Password.....">
            </div>
        </div>
        </form>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn btn-primary" id="btnSave">Save</button>
        </div>
      </div>
    </div>
  </div>
  <!-- End div modal edit-->


</body>

</html>